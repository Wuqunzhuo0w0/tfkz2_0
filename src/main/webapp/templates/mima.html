	<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>忘记密码</title>
    <meta name="Keywords" content="同福客栈，同福客栈酒水，酒水电商" />

	<!-- CSS Files -->
    <link href="../css/mima/bootstrap.min.css" rel="stylesheet" />
	<link href="../css/mima/paper-bootstrap-wizard.css" rel="stylesheet" />

	<!-- CSS Just for demo purpose, don't include it in your project -->
	<link href="../css/mima/demo.css" rel="stylesheet" />

	<!-- Fonts and Icons -->
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.css" rel="stylesheet">
	<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
	<link href="../css/mima/themify-icons-demo.css" rel="stylesheet">
</head>

<body>
	<div class="image-container set-full-height">
	    <!--   Creative Tim Branding   -->
	    <a href="#">
	         <div class="logo-container">
	            <div class="brand">
					<a href="main.html">首页</a>
	            </div>
	        </div>
	    </a>
		<!--  Made With Paper Kit  -->
	    <!--   Big container   -->
	    <div class="container">
	        <div class="row">
		        <div class="col-sm-8 col-sm-offset-2">

		            <!--      Wizard container        -->
		            <div class="wizard-container">

		                <div class="card wizard-card" data-color="orange" id="wizardProfile">
		                    <form action="" method="">
		                <!--        You can switch " data-color="orange" "  with one of the next bright colors: "blue", "green", "orange", "red", "azure"          -->

		                    	<div class="wizard-header text-center">
		                        	<h3 class="wizard-title">修改密码</h3>
		                    	</div>
								<div class="wizard-navigation">
									<div class="progress-with-circle">
									     <div class="progress-bar" role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="3" style="width: 21%;"></div>
									</div>
									<ul>
			                            <li>
											<a href="#about" data-toggle="tab">
												<div class="icon-circle">
													<i class="ti-user">1</i>
												</div>
												第一步
											</a>
										</li>
			                            <li>
											<a href="#account" data-toggle="tab">
												<div class="icon-circle">
													<i class="ti-settings">2</i>
												</div>
												第二步
											</a>
										</li>
			                            <li>
											<a href="#address" data-toggle="tab">
												<div class="icon-circle">
													<i class="ti-map">3</i>
												</div>
												第三步
											</a>
										</li>
			                        </ul>
								</div>
								<div class="tab-content">
		                            <div class="tab-pane" id="about">
		                            	<div class="row">
											<h5 class="info-text"> 请按次序输入</h5>
										  <div class="col-sm-10 col-sm-offset-1">
												<div class="form-group">
													<label>用户名</label>
													<input name="firstname" id="username" type="text" class="form-control" placeholder="请输入用户名">
												</div>
											</div>
											<div class="col-sm-10 col-sm-offset-1">
												<div class="form-group">
													<label>邮箱</label>
													<input name="email" type="email" class="form-control" placeholder="请输入邮箱">
												</div>
										  </div>
										</div>
		                            </div>
		                            <div class="tab-pane" id="account">
		                                <h5 class="info-text"> 请按次序输入</h5>
		                                <div class="row">
											<div class="col-sm-10 col-sm-offset-1">
												<div class="form-group">
													<label>密保问题</label>
													<input name="question" id="question" type="text" class="form-control" placeholder="请输入密保问题" >
												</div>
											</div>
											<div class="col-sm-10 col-sm-offset-1">
												<div class="form-group">
													<label>密保答案</label>
													<input name="answer" id="answer" type="text" class="form-control" placeholder="请输入密保答案">
												</div>
										  </div>
		                                </div>
		                            </div>
		                            <div class="tab-pane" id="address">
										<h5 class="info-text"> 请按次序输入</h5>
		                                <div class="row">
											<div class="col-sm-10 col-sm-offset-1">
												<div class="form-group">
													<label>新密码</label>
													<input name="new" id="passwordNew" type="text" class="form-control" placeholder="请输入新密码">
												</div>
											</div>
											<div class="col-sm-10 col-sm-offset-1">
												<div class="form-group">
													<label>再输一次</label>
													<input name="new" type="text" class="form-control" placeholder="请再输一次">
												</div>
										  </div>
		                                </div>
		                            </div>
		                        </div>
		                        <div class="wizard-footer">
		                            <div class="pull-right">
		                                <input type='button' class='btn btn-next btn-fill btn-warning btn-wd' name='next' id="next_step" value='下一步' />
		                                <input type='button' class='btn btn-finish btn-fill btn-warning btn-wd' name='finish' id="finish" value='完成' />
		                            </div>

		                            <div class="pull-left">
		                                <input type='button' class='btn btn-previous btn-default btn-wd' name='previous' value='前一步' />
		                            </div>
		                            <div class="clearfix"></div>
		                        </div>
		                    </form>
		                </div>
		            </div> <!-- wizard container -->
		        </div>
	    	</div><!-- end row -->
		</div> <!--  big container -->

	    <div class="footer">
	        <div class="container text-center">
				购买前请确认达到法定饮酒年龄！同福客栈不销售含酒精产品给18岁以下人士</br>Copyright &copy; 2019-同福客栈 版权所有
	        </div>
	    </div>
	</div>

</body>

	<!--   Core JS Files   -->
	<script src="../js/mima/jquery-2.2.4.min.js" type="text/javascript"></script>
	<script src="../js/mima/bootstrap.min.js" type="text/javascript"></script>
	<script src="../js/mima/jquery.bootstrap.wizard.js" type="text/javascript"></script>

	<!--  Plugin for the Wizard -->
	<script src="../js/mima/paper-bootstrap-wizard.js" type="text/javascript"></script>

	<!--  More information about jquery.validate here: http://jqueryvalidation.org/	 -->
	<script src="../js/mima/jquery.validate.min.js" type="text/javascript"></script>

	<script>
        $(document).ready(function(){
            var token;
            $("#next_step").click(function () {
              	var valu;
              	valu = $("#answer").val();
              	if(valu==""){
                    $.post("http://localhost:8089/portal/user/forget_get_question.do",
                        {
                            username:$("#username").val(),
                        },
                        function(data,status){
                            // alert(data.toString());
                            // data={"status":100,"data":null,"msg":"用户名不能为空","success":false}
                            // var json = eval("("+data+")"); // data的值是json字符串，这行把字符串转成object
                            // var json = eval(data); // data的值是json字符串，这行把字符串转成object
                            var b = JSON.stringify(data);
                            var problem;
                            //alert(b);
                            var resultstatus = data.status;   //没有声明的需要声明这些变量，我之前声明过var ***
                            if(resultstatus==0){
                                problem = data.data;
                                $("#question").val(problem);
                            }else if(resultstatus==1) {
                                alert("该用户未设置找回密码问题")
                            }else if(resultstatus==100) {
                                alert("用户名不能为空")
                            }else if(resultstatus==101) {
                                alert("用户名不存在")
                            };

                        });
				}else{
                    $.post("http://localhost:8089/portal/user/forget_check_answer.do",
                        {
                            username:$("#username").val(),
                            question:$("#question").val(),
                            answer:$("#answer").val(),
                        },
                        function(data,status){
                            // alert(data.toString());
                            // data={"status":100,"data":null,"msg":"用户名不能为空","success":false}
                            // var json = eval("("+data+")"); // data的值是json字符串，这行把字符串转成object
                            // var json = eval(data); // data的值是json字符串，这行把字符串转成object
                            //var b = JSON.stringify(data);
                            //alert(b);
                            var resultstatus = data.status;   //没有声明的需要声明这些变量，我之前声明过var ***
                            if(resultstatus==0){
                                token = data.data;
                                alert(token);


                            };

                        });
				}

            })
			$("#finish").click(function () {
                $.post("http://localhost:8089/portal/user//forget_reset_password.do",
                    {
                        username:$("#username").val(),
                        passwordNew:$("#passwordNew").val(),
                        forgetToken:token,
                    },
                    function(data,status){

                        var resultstatus = data.status;   //没有声明的需要声明这些变量，我之前声明过var ***
                        if(resultstatus==0){
                            alert("修改密码成功")
                            window.location.href = "login.html";
                        }else if(resultstatus==1) {
                            alert("修改密码操作失败")
                        }else if(resultstatus==103) {
                            alert("token已经失效")
                        };

                    });
            })
        });
	</script>

</html>
